"use strict";(self.webpackChunkmilliwonkim_blog_site=self.webpackChunkmilliwonkim_blog_site||[]).push([[5826],{3905:(e,n,t)=>{t.d(n,{Zo:()=>d,kt:()=>f});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var p=r.createContext({}),s=function(e){var n=r.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},d=function(e){var n=s(e.components);return r.createElement(p.Provider,{value:n},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},u=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,p=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),c=s(t),u=a,f=c["".concat(p,".").concat(u)]||c[u]||m[u]||o;return t?r.createElement(f,l(l({ref:n},d),{},{components:t})):r.createElement(f,l({ref:n},d))}));function f(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,l=new Array(o);l[0]=u;var i={};for(var p in n)hasOwnProperty.call(n,p)&&(i[p]=n[p]);i.originalType=e,i[c]="string"==typeof e?e:a,l[1]=i;for(var s=2;s<o;s++)l[s]=t[s];return r.createElement.apply(null,l)}return r.createElement.apply(null,t)}u.displayName="MDXCreateElement"},7406:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>l,default:()=>m,frontMatter:()=>o,metadata:()=>i,toc:()=>s});var r=t(7462),a=(t(7294),t(3905));const o={title:"Next.js\uc758 \ub80c\ub354\ub9c1 \uacfc\uc815 \ud30c\uc545\ud558\uae30"},l="1. Server Code",i={unversionedId:"front-end-development/nextjs/3",id:"front-end-development/nextjs/3",title:"Next.js\uc758 \ub80c\ub354\ub9c1 \uacfc\uc815 \ud30c\uc545\ud558\uae30",description:"Next.js \uc11c\ubc84\uc5d0\uc11c HTML \uc0dd\uc131\ud558\ub294 \ubc95",source:"@site/docs/front-end-development/nextjs/3.md",sourceDirName:"front-end-development/nextjs",slug:"/front-end-development/nextjs/3",permalink:"/docs/front-end-development/nextjs/3",draft:!1,tags:[],version:"current",lastUpdatedBy:"milliwonkim",lastUpdatedAt:1700371188,formattedLastUpdatedAt:"Nov 19, 2023",frontMatter:{title:"Next.js\uc758 \ub80c\ub354\ub9c1 \uacfc\uc815 \ud30c\uc545\ud558\uae30"},sidebar:"developmentSidebar",previous:{title:"Next.js 13 + Kakao Map API \uc2dc CORS \ubb38\uc81c",permalink:"/docs/front-end-development/nextjs/2"},next:{title:"Difference between Static Site Generation (SSG) and Server Side Rendering (SSR) in Next.js",permalink:"/docs/front-end-development/nextjs/4"}},p={},s=[{value:"Next.js \uc11c\ubc84\uc5d0\uc11c HTML \uc0dd\uc131\ud558\ub294 \ubc95",id:"nextjs-\uc11c\ubc84\uc5d0\uc11c-html-\uc0dd\uc131\ud558\ub294-\ubc95",level:3},{value:"hydrate\ub780?",id:"hydrate\ub780",level:3}],d={toc:s},c="wrapper";function m(e){let{components:n,...t}=e;return(0,a.kt)(c,(0,r.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"1-server-code"},"1. Server Code"),(0,a.kt)("h3",{id:"nextjs-\uc11c\ubc84\uc5d0\uc11c-html-\uc0dd\uc131\ud558\ub294-\ubc95"},"Next.js \uc11c\ubc84\uc5d0\uc11c HTML \uc0dd\uc131\ud558\ub294 \ubc95"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"export async function renderToHTML(\n  req: IncomingMessage,\n  res: ServerResponse,\n  pathname: string,\n  query: NextParsedUrlQuery,\n  renderOpts: RenderOpts\n): Promise<RenderResult | null> {\n  // ...\n\n  const renderDocument = async () => {\n    // ...\n    async function loadDocumentInitialProps(\n      renderShell?: (\n        _App: AppType,\n        _Component: NextComponentType\n      ) => Promise<ReactReadableStream>\n    ) {\n      // ...\n      const renderPage: RenderPage = (\n        options: ComponentsEnhancer = {}\n      ): RenderPageResult | Promise<RenderPageResult> => {\n        // ...\n        const html = ReactDOMServer.renderToString(\n          <Body>\n            <AppContainerWithIsomorphicFiberStructure>\n              {renderPageTree(EnhancedApp, EnhancedComponent, {\n                ...props,\n                router,\n              })}\n            </AppContainerWithIsomorphicFiberStructure>\n          </Body>\n        );\n        return { html, head };\n      };\n    }\n    // ...\n    return {\n      bodyResult,\n      documentElement,\n      head,\n      headTags: [],\n      styles,\n    };\n  };\n}\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\ub2e4\uc74c\uc758 \ucf54\ub4dc\ub97c \uc774\uc6a9\ud574\uc11c, \uc11c\ubc84 \ub2e8\uc5d0\uc11c ReactNode\ub97c HTML string\uc73c\ub85c \ub9cc\ub4ec",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\uadf8\ub9ac\uace0 \uc774\ub807\uac8c \uc0dd\uc131\ub41c HTML\uc740 htmlProps\uac00 \ub418\uc5b4 document\ub85c \ubc18\ud658\ub41c\ub2e4."),(0,a.kt)("li",{parentName:"ul"},"Next.js\ub85c \ub9cc\ub4e4\uc5b4\uc9c4 \ud398\uc774\uc9c0\uc758 Network \ud0ed\uc5d0\uc11c \uc11c\ubc84\uc5d0\uc11c \ubc18\ud658\ud55c HTML\uc744 \ubcfc \uc218 \uc788\uc74c")))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"// src/server/render.tsx\n\nexport async function renderToHTML(\n  req: IncomingMessage,\n  res: ServerResponse,\n  pathname: string,\n  query: NextParsedUrlQuery,\n  renderOpts: RenderOpts\n): Promise<RenderResult | null> {\n  // ...\n\n  const documentResult = await renderDocument();\n\n  const htmlProps: HtmlProps = {\n    __NEXT_DATA__: {\n      // ...\n    },\n  };\n\n  const document = (\n    <AmpStateContext.Provider value={ampState}>\n      <HtmlContext.Provider value={htmlProps}>\n        {documentResult.documentElement(htmlProps)}\n      </HtmlContext.Provider>\n    </AmpStateContext.Provider>\n  );\n\n  const documentHTML = ReactDOMServer.renderToStaticMarkup(document);\n\n  // ...\n  // \uc6b4\uc601\ud658\uacbd \uc5ec\ubd80\uc5d0 \ub530\ub77c prefix\uc5d0 \uc18d\uc131\uc744 \ub2e4\ub974\uac8c \ud558\uace0,\n  // prefix\uc640 suffix \uc815\ubcf4\ub97c \uac00\uc9c4 streams\ub97c \uc120\uc5b8\ud55c\ub2e4\n  // \uc774\ub54c '\x3c!-- __NEXT_DATA__ --\x3e'\uac00 prefix\uc5d0 \uc785\ub825\ub41c\ub2e4\n\n  if (generateStaticHTML) {\n    // ...\n    return new RenderResult(optimizedHtml);\n  }\n\n  return new RenderResult(\n    chainStreams(streams).pipeThrough(\n      createBufferedTransformStream(postOptimize)\n    )\n  );\n}\n")),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://s3-us-west-2.amazonaws.com/secure.notion-static.com/61c202ed-e645-4339-bcdd-6cd37f6ce4f4/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-08-16_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_1.07.51.png",alt:"\u1109\u1173\u110f\u1173\u1105\u1175\u11ab\u1109\u1163\u11ba 2023-08-16 \u110b\u1169\u1112\u116e 1.07.51.png"})),(0,a.kt)("h1",{id:"2-client-code"},"2. Client Code"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"// client/next.js\n\ninitialize({})\n  .then(() => hydrate())\n  .catch(console.error);\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},'// client/index.tsx\n\nexport async function initialize(opts: { webpackHMR?: any } = {}): Promise<{\n  assetPrefix: string;\n}> {\n  // initialize()\n  // __NEXT_DATA__fmf id\ub85c \uac16\ub294 \uc694\uc18c\uc758 \ucee8\ud150\uce20\ub97c\n  // window\uac1d\uccb4\uc5d0 __NEXT_DATA__\ud0a4\ub85c \uc800\uc7a5\ud568\n  initialData = JSON.parse(\n    document.getElementById("__NEXT_DATA__")!.textContent!\n  );\n  window.__NEXT_DATA__ = initialData;\n\n  const prefix: string = initialData.assetPrefix || "";\n\n  appElement = document.getElementById("__next");\n  return { assetPrefix: prefix };\n}\n\n// \uc2e4\ud589\ud558\ub824\ub294 \ud398\uc774\uc9c0\uc758 \uc5d0\ub7ec\uac00 \uc788\ub294\uc9c0 \ud655\uc778 \ubc0f validation \uccb4\ud06c\nexport async function hydrate(opts?: { beforeRender?: () => Promise<void> }) {\n  // ...\n  const renderCtx: RenderRouteInfo = {\n    App: CachedApp,\n    initial: true,\n    Component: CachedComponent,\n    props: initialData.props,\n    err: initialErr,\n  };\n\n  render(renderCtx);\n}\n\nasync function render(renderingProps: RenderRouteInfo): Promise<void> {\n  // ...\n  await doRender(renderingProps);\n}\n\nfunction doRender(input: RenderRouteInfo): Promise<any> {\n  // ...\n  renderReactElement(appElement!, (callback) => (\n    <Root callbacks={[callback, onRootCommit]}>\n      {process.env.__NEXT_STRICT_MODE ? (\n        <React.StrictMode>{elem}</React.StrictMode>\n      ) : (\n        elem\n      )}\n    </Root>\n  ));\n}\n\nlet shouldHydrate: boolean = true; // \uccab \ub80c\ub354\uc5d0\uc11c\ub294 \ud56d\uc0c1 true\uc774\ub2e4\n\nfunction renderReactElement(\n  domEl: HTMLElement,\n  fn: (cb: () => void) => JSX.Element\n): void {\n  //...\n  const reactEl = fn(shouldHydrate ? markHydrateComplete : markRenderComplete);\n\n  // ...\n  if (shouldHydrate) {\n    ReactDOM.hydrate(reactEl, domEl);\n    shouldHydrate = false;\n  } else {\n    ReactDOM.render(reactEl, domEl);\n  }\n}\n')),(0,a.kt)("h3",{id:"hydrate\ub780"},"hydrate\ub780?"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\uc11c\ubc84\uc5d0\uc11c \ub80c\ub354\ub9c1\ub41c HTML\uc5d0 \uae30\ubc18\ud574\uc11c, \ud074\ub77c\uc774\uc5b8\ud2b8\uce21\uc5d0\uc11c \uc790\ubc14\uc2a4\ud06c\ub9bd\ud2b8 \uc774\ubca4\ud2b8, \uc0c1\ud0dc\ub97c \uc5f0\uacb0\ud558\ub294 \uacfc\uc815",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\ucd08\uae30 \ub85c\ub529 \uc2dc, \uc989\uc2dc \uc0c1\ud638\uc791\uc6a9 \uac00\ub2a5"),(0,a.kt)("li",{parentName:"ul"},"\uc774\ud6c4\uc5d0\ub294 \uc77c\ubc18 \ub9ac\uc561\ud2b8\ucc98\ub7fc \ub3d9\uc791\uac00\ub2a5"))),(0,a.kt)("li",{parentName:"ul"},"hydrate\uac00 \uc5c6\uc73c\uba74 \uc11c\ubc84\uce21\uc5d0\uc11c \ub80c\ub354\ub9c1\ub41c HTML\uc744 \ubb34\uc2dc\ud558\uace0",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\ud074\ub77c\uc774\uc5b8\ud2b8 \uce21\uc5d0\uc11c \uc0c8\ub85c \ub80c\ub354\ub9c1\ud574\uc57c\ud568"),(0,a.kt)("li",{parentName:"ul"},"Next.js\uc5d0\uc11c\ub294",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"hydrate\ub294 \uc11c\ubc84\uc5d0\uc11c \ub80c\ub354\ub9c1\ub41c HTML\uc744 \uac00\uc838\uc640 \uae30\uc874 \ud074\ub77c\uc774\uc5b8\ud2b8\uc5d0 \uc774\ubbf8 \uc874\uc7ac\ud558\ub294 \ub9c8\ud06c\uc5c5\uacfc \uc77c\uce58\uc2dc\ud0a4\uae30 \uc704\ud574 \uc0ac\uc6a9\ub429\ub2c8\ub2e4.",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\uae30\uc874 \ub9c8\ud06c\uc5c5\uc740 \uc11c\ubc84\uc5d0\uc11c \ub80c\ub354\ub9c1\ub420 \ub54c \uc0dd\uc131\ub418\uace0, \ud074\ub77c\uc774\uc5b8\ud2b8\uc5d0\uc11c\ub294 \uae30\uc874 \ub9c8\ud06c\uc5c5\uacfc \uc77c\uce58\ud558\ub294 \ucef4\ud3ec\ub10c\ud2b8\ub97c \ucc3e\uc544 \uc774\ubca4\ud2b8 \ucc98\ub9ac \ubc0f \uc0c1\ud0dc \uc5c5\ub370\uc774\ud2b8\ub97c \uc5f0\uacb0\ud569\ub2c8\ub2e4.",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\uc11c\ubc84\uc5d0\uc11c \uc0dd\uc131\ub41c HTML\uacfc \ud074\ub77c\uc774\uc5b8\ud2b8\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \ub9ac\uc561\ud2b8 \ucf54\ub4dc \uc0ac\uc774\uc758 \ub3d9\uae30\ud654"))))),(0,a.kt)("li",{parentName:"ul"},"\uc774\ub7ec\ud55c \uacfc\uc815\uc744 \uc21c\uc11c\ub300\ub85c \uc815\ub9ac\ud558\uba74 \uc774\ub807\uc2b5\ub2c8\ub2e4.",(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},"\uc11c\ubc84\uc5d0\uc11c\ub294 Next.js\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub9ac\uc561\ud2b8 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \ub80c\ub354\ub9c1\ud558\uace0, \uc0dd\uc131\ub41c HTML\uc744 \ud074\ub77c\uc774\uc5b8\ud2b8\ub85c \uc804\uc1a1\ud569\ub2c8\ub2e4."),(0,a.kt)("li",{parentName:"ol"},"\ud074\ub77c\uc774\uc5b8\ud2b8\uc5d0\uc11c\ub294 \uc804\uc1a1\ub41c HTML\uc744 \uac00\uc838\uc640\uc11c \uae30\uc874 \ub9c8\ud06c\uc5c5\uacfc \uc77c\uce58\uc2dc\ud0b5\ub2c8\ub2e4."),(0,a.kt)("li",{parentName:"ol"},"\uc77c\uce58\ud558\ub294 \ucef4\ud3ec\ub10c\ud2b8\ub97c \ucc3e\uc544 \ud574\ub2f9 \ucef4\ud3ec\ub10c\ud2b8\uc758 \uc774\ubca4\ud2b8 \ucc98\ub9ac \ubc0f \uc0c1\ud0dc \uc5c5\ub370\uc774\ud2b8\ub97c \ud65c\uc131\ud654\ud569\ub2c8\ub2e4."),(0,a.kt)("li",{parentName:"ol"},"\ud074\ub77c\uc774\uc5b8\ud2b8\uc5d0\uc11c\ub294 \uc774\uc81c \uc77c\ubc18\uc801\uc778 \ub9ac\uc561\ud2b8 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\ucc98\ub7fc \ub3d9\uc791\ud558\uba70, \uc0c1\ud638\uc791\uc6a9\uacfc \uc0c1\ud0dc \ubcc0\ud654\uc5d0 \ub530\ub77c UI\ub97c \uc5c5\ub370\uc774\ud2b8\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."))))),(0,a.kt)("li",{parentName:"ul"},"React \uc5d0\uc11c\ub294",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"react\uc758 hydration\uc740 \uc790\ub3d9\uae30\ub2a5\uc774 \uc544\ub2c8\ub77c SSR\uc744 \ud560 \ub54c\uc5d0 \uad73\uc774 render\ud2b8\ub9ac\ub97c \ub9cc\ub4e4\uc9c0 \uc54a\uace0 \uae30\uc874\uc5d0 \ud615\uc131\ub41c DOM\uc5d0 \uc774\ubca4\ud2b8\ub9cc \ubd99\uc774\uba74 \ub418\ubbc0\ub85c \ud574\ub2f9 \uacfc\uc815\uc744 \uc2e4\ud589\ud558\ub294 \uba54\uc11c\ub4dc\uc774\ub2e4."),(0,a.kt)("li",{parentName:"ul"},"react \uc758 Root \uac1c\ub150\uc774 \uc5c5\ub370\uc774\ud2b8\ub418\uba74\uc11c, \uc774\uc81c\ub294 createRoot \uba54\uc11c\ub4dc\ub97c \ud638\ucd9c\ud558\uc5ec \ub9cc\ub4e4\uc5b4\uc9c0\ub294 \ud074\ub85c\uc838 \ud658\uacbd\uc5d0 root\ub97c \ub4f1\ub85d\ud558\uace0 \ub9ac\ud134\ub418\ub294 \uac1d\uccb4\uc758 \uba54\uc11c\ub4dc\uc5d0 \uc874\uc7ac\ud558\ub294 hydrate\uad00\ub828 \ud568\uc218\ub97c \uc774\uc6a9\ud574 SSR\ub85c \uc804\ub2ec\ubc1b\uc740 html\uc5d0 \uc774\ubca4\ud2b8 \ud578\ub4e4\ub7ec\ub97c \ubd99\uc5ec\uc904 \uc218 \uc788\uac8c \ub418\uc5c8\ub2e4."))))),(0,a.kt)("li",{parentName:"ul"},"createRoot\uc640 hydrateRoot \ube44\uad50\ud558\uae30")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},'import React from "react";\nimport * as ReactDOM from "react-dom/client";\nimport App from "./App";\n\nconst container = document.getElementById("root");\n\n// \ud074\ub77c\uc774\uc5b8\ud2b8 \uc0ac\uc774\ub4dc \ub80c\ub354\ub9c1 (Client-Side Rendering)\nconst root = ReactDOM.createRoot(container);\nroot.render(<App />);\n\n// \uc11c\ubc84 \uc0ac\uc774\ub4dc \ub80c\ub354\ub9c1 \ud6c4 \ud074\ub77c\uc774\uc5b8\ud2b8\uc5d0\uc11c \ud558\uc774\ub4dc\ub808\uc774\uc158 (Server-Side Rendering + Hydration)\nconst hydrateRoot = ReactDOM.hydrateRoot(container, <App />);\nhydrateRoot.render(<App />);\n')),(0,a.kt)("hr",null),(0,a.kt)("p",null,"\ucc38\uace0"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://www.howdy-mj.me/next/hydrate"},"Next.js\uc758 \ub80c\ub354\ub9c1 \uacfc\uc815(Hydrate) \uc54c\uc544\ubcf4\uae30")),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://velog.io/@chltjdrhd777/React-hydration%EC%9D%B4%EB%9E%80-root%EB%9E%80"},"[React] hydration\uc774\ub780? (+ root\ub780?)")))}m.isMDXComponent=!0}}]);