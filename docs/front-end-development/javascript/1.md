---
title: Browser operating principles + React principles
---

<aside>
ğŸ’¡ Browser Operating Principle = Rendering Process = Critical Rendering Path

</aside>

![image](img/1/1.png)

- Creating DOM(Document Object Model)

  - Lifecycle Method: DOMContentLoaded, load, beforeunload, unload

  1. DOMContentLoaded
     - Occurs immediately after completion of the DOM tree.
     - No Wait for assets like img, css etc

  ```html
  <script>
    function ready() {
      alert("DOM is ready!");

      // size is 0X0 as it is not loaded
      alert(`img size: ${img.offsetWidth}x${img.offsetHeight}`);
    }

    document.addEventListener("DOMContentLoaded", ready);
  </script>

  <img id="img" src="https://en.js.cx/clipart/train.gif?speed=1&cache=0" />
  ```

  - If multiple script tags exist => DOMCcontentLoaded runs after all scripts run
    (reason: DOMcontentLoaded may have logic related to DOM manipulation)

  ```html
  <!-- b => c => a -->

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      alert("DOM is ready!");
    });
    // a
  </script>

  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.3.0/lodash.js"
  >
    // b
  </script>

  <script>
    // c
    alert("ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë”©ì´ ëë‚˜ê³  ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ê°€ ì‹¤í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.");
  </script>
  ```

  - Scripts created dynamically with document.createElement ('script')
    - and added to web pages do not prevent DOMCentLoaded.
    - if script location after CSS loading link tag - Script tag will not run until CSS loading is complete - Therefore, DOMCcontentLoaded runs after style loading too
      (reason: Possible use of style-affected properties during JS like img, offsetTopâ€¦)

  1. load
     => Executed when all external resources such as img and CSS are loaded
  1. beforeunload /
     => Occurs when a user leaves the page
     !https://blog.kakaocdn.net/dn/bwVtza/btrMI23XIp7/f7LpqlCEGumD6kfIPvEsg0/img.png
  1. unload (the last thing to do when you really leave)
     => Occurs when a user leaves the page

  ```jsx
  // only document
  window.addEventListener("DOMContentLoaded", (event) => {
    console.log("DOMContentLoaded");
  });

  // after resources (css, images)
  window.addEventListener("load", (event) => {
    console.log("load");
  });

  // before unload
  window.addEventListener("beforeunload", (event) => {
    console.log("beforeunload");
  });

  // resource is being unloaded
  window.addEventListener("unload", (event) => {
    console.log("unload");
  });
  ```

- Creating CSSOM(Cascade Style Sheet Object Model)

  - DOM + CSS = CSSOM
    => DOM + CSSOM = Render Tree
    ![image](img/1/2.png)
  - `display:none` applied to DOM => including to Final Render Tree
  - `visibility: hidden / opacity: 0` => including to Final Render Tree(Element exists, but not visible)
    ![image](img/1/3.png)

  ### Parsing HTML, CSS, JS(= Synchronous Parsing)

  - at facing <link /> tag while parsing HTML â‡’ simultaneously parsing HTML, CSS

    => CSS doesnâ€™t change DOM structure

  - JS can change DOM structure, then if you face script tag, then stop parsing HTML parse and start JS parse

  ## No blocking if you use defer, async(= Asynchronous Parsing)

  - async

    - JS assets is downloaded at background environment
    - JS assets is loaded async, JS parsing is after HTML parsing
      - JS runs with HTML parsing pause
    - if thereâ€™s multiple async, running order is on itâ€™s own terms

    ```html
    <script
      async
      src="https://javascript.info/article/script-async-defer/long.js"
    ></script>
    <script
      async
      src="https://javascript.info/article/script-async-defer/small.js"
    ></script>

    <!-- small.js is run first before long.js -->
    ```

    - DOMContentLoadedÂ event, async script is not waiting each other.

    1. If the async script is downloaded after the page is configured, DOMCcontentLoaded may occur before the async script is executed,
    2. If the async script is short and is downloaded before the page configuration is finished, or if the script is cached, DOMCcontentLoaded can also occur after the async script is executed.

  - defer

    - JS download runs in the background
    - JS load is asynchronous, JS execution is synchronized (HTML parsing is completed)
    - Executed before the DOMCcontentLoaded event occurs

    ```html
    <!-- a -->
    <p>...content after script...</p>

    <!-- b -->
    <script
      defer
      src="https://javascript.info/article/script-async-defer/long.js?speed=1"
    ></script>

    <!-- see now! -->
    <!-- c -->
    <p>...script after content...</p>

    <!-- order a => c => b -->
    ```

    - The above script runs and the below script runs (small.js, a small script, is download before long.js, a long script)

    ```html
    <!-- a -->
    <script
      defer
      src="https://javascript.info/article/script-async-defer/long.js"
    ></script>
    <!-- b -->
    <script
      defer
      src="https://javascript.info/article/script-async-defer/small.js"
    ></script>

    <!-- b runs after a is completed -->
    ```

    - if src in script is not exists, then defer property is ignored(inline script tag is ignored)

    ```html
    <!-- defer is not applied -->
    <script defer>
      document.addEventListener("DOMContentLoaded", () =>
        alert("DOM is ready after running `defer`script")
      ); // (2)
    </script>

    <!-- defer is applied -->
    <script
      defer
      src="https://javascript.info/article/script-async-defer/long.js?speed=1"
    ></script>
    ```

- Creating Render Tree = DOM + CSSOM
- Run â€œLayoutâ€ process
  - Each node in the render tree => Calculate which viewport and where it should be placed
    - Relative properties such as %, vh, vw are converted to px
- Run â€œPaintâ€ process
  - draw each node in the render tree as a real pixel on the monitor
    - When reflow occurs, paint must occur
      > However, if there are properties that affect the layout, such as background-color, visibility, etc., do not need to reflow => Therefore, only paint is performed
  - Property that neither Layout nor Paint occurs
    - transform, opacitiy, cursor, orphans, perspective etc
    - Rendering is faster than the 'Paint Only' property (absolutely reduced operations)
      > => If possible, it is recommended to use properties that do not cause Repaint or Reflow.
    - Different rendering engines in your browser(chrome, safari, firefox etc) might have different steps to process CSS properties

### ê°€ìƒë”(Virtual DOM) íŠ¹ì§•

- í˜„ì¬ ë”ì˜ ë³µì‚¬ë³¸ì¸ ê°€ìƒë” Aì™€, ë³€ê²½ì´ ìˆëŠ” ê°€ìƒë” B(ë©”ëª¨ë¦¬ì— ìƒˆë¡œ ìƒì„±)ë¥¼ ë¹„êµ(íœ´ë¦¬ìŠ¤í‹± ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ë¹„êµ) => ì°¨ì´ì ì˜ ëª¨ë“  ë¶€ë¶„ì„ ì¼ê´„ì ìœ¼ë¡œ, ë¦¬ì•¡íŠ¸ê°€ ì‹¤ì œ DOMì— ë°˜ì˜í•œë‹¤
- ë°°ì¹˜(batch) => DOM ì—…ë°ì´íŠ¸ë¥¼ ì¼ê´„ì ìœ¼ë¡œ ì²˜ë¦¬ => ì‹¤ì œ ë”ì˜ ë¦¬ë Œë”ë§ ì—°ì‚°ì„ ìµœì†Œí™”(ì—°ì‡„ì  ë¦¬í”Œë¡œìš°, ë¦¬í˜ì¸íŠ¸ ë°œìƒ ë§‰ìŒ)

### **ì‘ì€ ê·œëª¨ì˜ ë ˆì´ì•„ì›ƒ(ë¦¬í”Œë¡œìš°)ì´ ì—¬ëŸ¬ë²ˆ ë°œìƒí•˜ëŠ” ê²ƒë³´ë‹¤**

### **í° ê·œëª¨ì˜ ë ˆì´ì•„ì›ƒì´ í•œ ë²ˆ ë°œìƒí•˜ëŠ” ê²ƒì€ ì„±ëŠ¥ìƒì˜ í° ì°¨ì´ë¥¼ ë‚˜íƒ€ëƒ„**

![image](img/1/4.png)

ì—…ë°ì´íŠ¸ ëœ ê°€ìƒë”ê³¼ ì´ì „ ê°€ìƒë”ì„ ë¹„êµ

---

# ì¬ì¡°ì •(Reconciliation)

- ë‹¤ìŒ ê°€ì •ì„ í†µí•´ => ì „ì²´ DOM íŠ¸ë¦¬ë¥¼ íƒìƒ‰í•˜ëŠ” ì‹œê°„ì„(O(n^3))ì—ì„œ O(n)ìœ¼ë¡œ ì¤„ì„
  - ì„œë¡œ ë‹¤ë¥¸ íƒ€ì…ì˜ ë‘ ì—˜ë¦¬ë¨¼íŠ¸ëŠ” ì„œë¡œ ë‹¤ë¥¸ íŠ¸ë¦¬ë¥¼ ë§Œë“¤ì–´ëƒ„(ì—˜ë¦¬ë¨¼íŠ¸ê°€ ë‹¤ë¥´ë©´ ë¹„êµ ì•ˆí•¨)
  - key propsë¥¼ í†µí•´ => keyê°€ ê°™ì€ ë…¸ë“œë¼ë¦¬ ë¹„êµí•¨
- ë¹„êµ ë°©ì‹

  - ë™ì¼í•œ ë ˆë²¨ì˜ ë…¸ë“œë“¤ë¼ë¦¬ë§Œ ë¹„êµ
  - ê°™ì€ ìœ„ì¹˜ì—ì„œ ì—˜ë¦¬ë¨¼íŠ¸ íƒ€ì…ì´ ë‹¤ë¥¸ ê²½ìš° => ê¸°ì¡´ íŠ¸ë¦¬ë¥¼ ì œê±°í•˜ê³  ìƒˆë¡­ê²Œ íŠ¸ë¦¬ë¥¼ ë§Œë“ ë‹¤(ë‚´ë¶€ ì—˜ë¦¬ë¨¼íŠ¸, ë‚´ë¶€ ì»´í¬ë„ŒíŠ¸ ëª¨ë‘ ì œê±° í›„ ë‹¤ì‹œ ìƒˆë¡œ ë§Œë“¬)
  - ê°™ì€ ìœ„ì¹˜ì—ì„œ ì—˜ë¦¬ë¨¼íŠ¸ì˜ íƒ€ì…ì´ ê°™ì€ ê²½ìš° => classê°€ ë³€ê²½ëë‹¤ë©´ ë³€ê²½ëœ attributesë§Œ ì—…ë°ì´íŠ¸í•œë‹¤ => ìì‹ ì—˜ë¦¬ë¨¼íŠ¸ë“¤ì— ë¹„êµì•Œê³ ë¦¬ì¦˜ì„ ì¬ê·€ì ìœ¼ë¡œ ì ìš©
  - ê°™ì€ ìœ„ì¹˜ì—ì„œ 'ì—˜ë¦¬ë¨¼íŠ¸ = ì»´í¬ë„ŒíŠ¸'ì´ê³ , íƒ€ì…ì´ ê°™ì€ê²½ìš° => ì»´í¬ë„ŒíŠ¸ ì¸ìŠ¤í„´íŠ¸ ìì²´ëŠ” ì•ˆë³€í•¨(state ìœ ì§€) + ë¼ì´í”„ì‚¬ì´í´ ë©”ì†Œë“œë¥¼ ì´ìš©í•´ propsê°€ ì—…ë°ì´íŠ¸ë¨ => render í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ì„œ ì»´í¬ë„ŒíŠ¸ ì´ì „ ì—˜ë¦¬ë¨¼íŠ¸ íŠ¸ë¦¬ì™€ ë‹¤ìŒ ì—˜ë¦¬ë¨¼íŠ¸ íŠ¸ë¦¬ì— ëŒ€í•´ ì¬ê·€ì ìœ¼ë¡œ ì ìš©
  - ìì‹ ë…¸ë“œì— ëŒ€í•œ ì¬ê·€ì  ì²˜ë¦¬ ì‹œ
    - => keyë¥¼ ì´ìš©í•´ ë™ì¼í•œ keyë¥¼ ê°–ëŠ” ìì‹ë“¤ë¼ë¦¬ë§Œ ë¹„êµí•œë‹¤ => ë”°ë¼ì„œ ItemC ë…¸ë“œë§Œ ì¶”ê°€ëœë‹¤. (keyê°€ ì—†ìœ¼ë©´ ë‘ë¦¬ìŠ¤íŠ¸ë¥¼ ëª¨ë‘ ìˆœíšŒí•´ì•¼í•¨)
    - => ì¸ë±ìŠ¤ë¥¼ keyë¡œ í•  ê²½ìš° =>Â ë¦¬ìŠ¤íŠ¸ì˜ ë°°ì—´ì´ ì¬ì •ë ¬ë˜ì§€ ì•Šê±°ë‚˜ last-childì—ì„œë§Œ ì¶”ê°€, ë³€ê²½, ì œê±°ê°€ ì¼ì–´ë‚œë‹¤ë©´ ì¸ë±ìŠ¤ë¥¼ í‚¤ë¡œ ì‚¬ìš©í•´ë„ë¨
    - => í•˜ì§€ë§Œ ë¦¬ìŠ¤íŠ¸ ìˆœì„œê°€ ë°”ë€Œë©´ keyê°€ ì „ë¶€ ë°”ë€Œì–´ì„œ keyì˜ ì˜ë¯¸ê°€ ì‚¬ë¼ì§

  ```html
  // before
  <ul>
    <li>ItemA</li>
    //ë¹„êµëŒ€ìƒ1
    <li>ItemB</li>
    //ë¹„êµëŒ€ìƒ2
  </ul>

  // after
  <ul>
    <li>ItemC</li>
    //ë¹„êµëŒ€ìƒ1 (ItemA -> ItemC ë¡œ ë³€ê²½)
    <li>ItemA</li>
    //ë¹„êµëŒ€ìƒ2 (ItemB -> ItemA ë¡œ ë³€ê²½)
    <li>ItemB</li>
    //ë¹„êµëŒ€ìƒ3 (ItemB ì¶”ê°€)
  </ul>
  ```

![image](img/1/5.png)

ë Œë”ë§ íŠ¸ë¦¬ ë¹„êµ

---

ì°¸ê³ 

[[React] Virtual DOMê³¼ ë¸Œë¼ìš°ì €ì˜ ë Œë”ë§ ê³¼ì •](https://velog.io/@1nthek/React-Virtual-DOMê³¼-ë Œë”ë§)

[ë¸Œë¼ìš°ì €ì˜ ë™ì‘ê³¼ì •ë¶€í„° Reactê¹Œì§€](https://velog.io/@kmlee95/ë¸Œë¼ìš°ì €ì˜-ë™ì‘ê³¼ì •ë¶€í„°-React)

[[React] ê°€ìƒë” Virtual DOMì´ë€?](https://dev-cini.tistory.com/11)

[ëª¨ë˜ JavaScript íŠœí† ë¦¬ì–¼](https://ko.javascript.info/)

[[JavaScript] ë¬¸ì„œì˜ ë¡œë”©ë˜ëŠ” ì‹œì  ì´ë²¤íŠ¸ ì œì–´í•˜ê¸° (ft. DOMContentLoaded, load, beforeunload, unload)](https://mine-it-record.tistory.com/577)
